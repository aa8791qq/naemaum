<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script>
        // 놓침?? -- 설명
        window.addEventListener('load', function () {
            document.querySelector('#btn1').addEventListener('click', function () {
                // ajax 객체 생성
                const xhr = new XMLHttpRequest();

                // 보낼준비
                // xhr.open('get', 'http://daum.net')
                xhr.open('get', 'https://jsonplaceholder.typicode.com/users')

                // 보내기
                xhr.send()

                //다녀온뒤
                xhr.onload = function () {
                    console.log('다녀왔습니다')
                    // console.log(xhr.responseText)

                    console.log(xhr.responseText)//?
                    // console.log(xhr.username)
                    const data = JSON.parse(xhr.responseText)
                    console.log(data)

                    // 첫번째 사람의
                    console.log(data[0])

                    // username 출력
                    console.log(data[0].username) // 약간 놓침 // 맞게해도 계속오류가 났었음, 배열안됨

                    // lat 출력
                    console.log(data[0].address.geo.lat)
                }
            })

            document.querySelector('#btn2').addEventListener('click', function () {
                // ajax 객체 생성
                const xhr = new XMLHttpRequest();

                // 보낼준비
                // xhr.open('get', 'http://daum.net')
                xhr.open('get', 'https://polling.finance.naver.com/api/realtime?query=SERVICE_ITEM:048550|SERVICE_RECENT_ITEM:048550,207940&_callback=window.__jindo2_call')

                // 보내기
                xhr.send()

                // 다녀온뒤
                xhr.onload = function () {
                    console.log('다녀왔습니다')
                    // console.log(xhr.responseText)


                }
            })

            document.querySelector('#btn3').addEventListener('click', function () {
                // ajax 객체 생성
                const xhr = new XMLHttpRequest();

                // 전달인자 보내는 방법(get방식)
                // 서버 ip : port(80 생략가능)/주소/
                //주소?키=벨류&key2=밸류2
                let url = 'http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getUltraSrtFcst'
                url += '?'
                url += 'serviceKey=lK%2BpeTdeyWia9YaaV6f0imO80lbjfLimavktA%2BJjIAzCLFe58rzMAZ2WGn4SnES09KwIFEs%2F5uGluAJOCIDf3w%3D%3D'
                url += '&'
                url += 'dataType=' + 'JSON'
                url += '&'
                url += 'base_date=' + '20250114'
                url += '&'
                url += 'base_time=' + '0930'
                url += '&'
                url += 'nx=' + '63'
                url += '&'
                url += 'ny=' + '110'
                url += '&'
                url += 'numOfRows=' + '100'
                console.log(url) // =을 빠뜨림

                xhr.open('get', url)

                // 보내기
                xhr.send()

                //다녀온뒤
                xhr.onload = function () {
                    console.log('다녀왔습니다')
                    console.log(xhr.responseText)

                    let data = JSON.parse(xhr.responseText)
                    // console.log(data)

                    // 3시간 분량의 표(시간, 기온(T1H), 강수량(RN1), 습도(REH)) 출력(오류 해결 때문에 설명 놓침)---->>>>
                    console.log(data.response)
                    console.log(data.response.body)
                    console.log(data.response.body.items.item)
                    let item = data.response.body.items.item
                    console.log(data.response.body.items.item[0].category)
                    let item2 = item[0].category
                    console.log(data.response.body.items.item[0].fcstDate)
                    let item3 = item[0].fsctDate
                    console.log(data.response.body.items.item[0].fcstTime)
                    let item4 = item[0].fsctDate
                    console.log(data.response.body.items.item[0].fcstValue)
                    let item5 = item[0].fsctDate

                    // 필터(놓침)
                    // let filtered = item.filter(function(obj){
                    //     if(obj.catagory == 'T1H' || obj.catagory == 'RN1' || obj.catagory == 'REH'){
                    //         return true
                    //     }
                    //     return false
                    // })
                    // console.log(filtered)
                    // filtered.sort(function(a,b){
                    //     return a.fcstTime - b.fcstTime
                    // })
                    // console.log(filtered)

                    

                }
            })
        })
        // 입력때매 놓침(오류해결때문에) // json을 사용해보자!----
        // let result = {}
        //     for(let i = 0; i<item.length; i++){
        //         if(obj.catagory == 'T1H'){
        //             if(result[item[i].fcstTime] == undefined){
        //                 result[item[i].fcstTime] = {}
        //             }
        //             result[item[i].fcstTime][item[i].category] = item[i].fcstValue
        //         } else if(obj.catagory == 'RN1'){
        //             if(result[item[i].fcstTime] == undefined){
        //                 result[item[i].fcstTime] = {}
        //             }
        //             result[item[i].fcstTime][item[i].category] = item[i].fcstValue
        //         } else if(obj.catagory == 'REH'){
        //             if(result[item[i].fcstTime] == undefined){
        //                 result[item[i].fcstTime] = {}
        //             }
        //             result[item[i].fcstTime][item[i].category] = item[i].fcstValue
        //     }
        //     console.log(result)
        // }

        window.addEventListener('load', function () {  // 필수요소 // 해결하느냐고 놓핌
            document.querySelector('#btn4').addEventListener('click', function () {
                const url = 'https://jsonplaceholder.typicode.com/users'
                // 보내는것
                let option = {
                    method: 'get',
                    headers: {
                        'key': 'value'
                    },
                    // body : '{a:123}' //여기에 올 수 없음
                }
                // 받는 것 // 놓침
                console.log(1)
                fetch(url, option).then(function (response) { // promise 내장
                    console.log(2)
                    // response : fetch가 돌려준 응답객체
                    return response.json()
                    // console.log(data)
                }).then(function (data) { // 변수 입력 실수 // 성공
                    console.log(data)
                }).catch(function (error) { // 실패
                    console.log(error)
                })
                console.log(3)
            })

            $('#btn5').off('click').on('click', function(){
                    $.ajax({
                        url : 'https://jsonplaceholder.typicode.com/users', //주소
                        type : 'get', //method
                        success : function(data){
                            //다녀오기 성공
                            console.log('성공')
                            console.log(data)
                        },
                        error : function(data2){
                            console.log('실패')
                            console.log(data2)
                        },
                        complete : function(){
                            console.log('무조건 실행')
                        }
                    })
                })
        
            // promise : 비동기방식이라 발생한 에러문구
            // promise, async/await

            // 에러해결문
            try{
                // 강제에러발생
                console.log(abc)
            } catch(errorMsg){
                console.log(errorMsg)
            }

            $('#btn6').off('click').on('click', function(){
                $.ajax({
                    url : 'https://jsonplaceholder.typicode.com/users', //주소
                    type : 'get', //method
                }).done(function(data){
                        //다녀오기 성공
                        console.log('성공')
                        console.log(data)
                }).fail(function(data2){
                        console.log('실패')
                        console.log(data2)
                }).always(function(){
                    console.log('무조건 실행')
                })
            })
        })

        // let j = {}
        // j.tensi = 1
        // /*
        //     {
        //         열시 : 1
        //     }
        // */
        // j.tensi = 2
        // /*
        //     {
        //         열시 : 2
        //     }
        // */
        // // j['1100'] = {
        // //     온도 : value,
        // //     습도 : value
        // // }
        // console.log(j)

        // 네트워크~~~

        // 다시 //
        function ajax(url) {

        }

    </script>
</head>

<body>
    <button type='button' id='btn1'>ajax 실행</button>
    <button type='button' id='btn2'>sm 주식 가져오기</button>
    <button type='button' id='btn3'>날씨</button>
    <button type='button' id='btn4'>fetch</button>
    <button type='button' id='btn5'>ajax1</button>
    <button type='button' id='btn6'>ajax2</button>
</body>
</html>